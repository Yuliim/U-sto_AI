import os
import pandas as pd
import numpy as np
from faker import Faker
import random
from datetime import datetime, timedelta


BASE_DIR = os.path.dirname(os.path.abspath(__file__))
SAVE_DIR = os.path.join(BASE_DIR, "data_lifecycle")
os.makedirs(SAVE_DIR, exist_ok=True) # í´ë”ê°€ ì—†ìœ¼ë©´ ìƒì„±
# ---------------------------------------------------------
# 0. ì„¤ì • ë° ì´ˆê¸°í™”
# ---------------------------------------------------------
fake = Faker('ko_KR')  # í•œêµ­ì–´ ë”ë¯¸ ë°ì´í„° ìƒì„±ê¸°
TOTAL_COUNT = 5000     # ìƒì„±í•  ë°ì´í„° ê°œìˆ˜ (ì•½ 5000ê±´)

# ìŠ¹ì¸ ìƒíƒœ ë¹„ìœ¨ ì„¤ì • (í™•ì • 97%, ëŒ€ê¸° 2%, ë°˜ë ¤ 1%)
APPROVAL_RATIOS = [0.97, 0.02, 0.01]
APPROVAL_STATUSES = ['í™•ì •', 'ëŒ€ê¸°', 'ë°˜ë ¤']
REMARK_TEMPLATES_BY_CLASS = {
    # IT / ì „ì‚° ì¥ë¹„
    "ë…¸íŠ¸ë¶ì»´í“¨í„°": [
        "AI ì‹¤ìŠµ ìˆ˜ì—…ìš© ë…¸íŠ¸ë¶",
        "ì „ì‚° ì‹¤ìŠµì‹¤ ê³µìš© ì¥ë¹„",
        "êµìˆ˜Â·ì—°êµ¬ì› ì—…ë¬´ìš©",
        "í•™ê³¼ ê³µìš© ì „ì‚° ìì‚°"
    ],
    "ë°ìŠ¤í¬í†±ì»´í“¨í„°": [
        "ì „ì‚° ì‹¤ìŠµì‹¤ ê³ ì •í˜• PC",
        "ì—°êµ¬ì‹¤ ë¶„ì„ ì—…ë¬´ìš©",
        "í–‰ì • ì—…ë¬´ìš© ë°ìŠ¤í¬í†±"
    ],
    "ì•¡ì •ëª¨ë‹ˆí„°": [
        "ì „ì‚° ì‹¤ìŠµì‹¤ ë³´ì¡° ëª¨ë‹ˆí„°",
        "ì‚¬ë¬´í™˜ê²½ ê°œì„ ìš©",
        "ì—°êµ¬ì‹¤ ë‹¤ì¤‘ í™”ë©´ êµ¬ì„±ìš©"
    ],
    "í—ˆë¸Œ": [
        "ì „ì‚°ë§ í™•ì¶©ìš©",
        "ì‹¤ìŠµì‹¤ ë„¤íŠ¸ì›Œí¬ êµ¬ì„±ìš©"
    ],
    "ë¼ìš°í„°": [
        "ì‹¤ìŠµì‹¤ ë„¤íŠ¸ì›Œí¬ ì¦ì„¤",
        "í•™ê³¼ ì „ì‚°ë§ ê³ ë„í™”"
    ],
    "í•˜ë“œë””ìŠ¤í¬ë“œë¼ì´ë¸Œ": [
        "ì—°êµ¬ ë°ì´í„° ì €ì¥ìš©",
        "ì„œë²„ ì¦ì„¤ìš© ìŠ¤í† ë¦¬ì§€"
    ],
    "í”Œë˜ì‹œë©”ëª¨ë¦¬ì €ì¥ì¥ì¹˜": [
        "êµìœ¡ ìë£Œ ë°°í¬ìš©",
        "ë°±ì—… ë§¤ì²´"
    ],
    "ìŠ¤ìºë„ˆ": [
        "í–‰ì • ë¬¸ì„œ ì „ì‚°í™”",
        "ìë£Œ ë””ì§€í„¸ ì•„ì¹´ì´ë¹™"
    ],
    "ë ˆì´ì €í”„ë¦°í„°": [
        "í–‰ì • ë¬¸ì„œ ì¶œë ¥ìš©",
        "í•™ê³¼ ê³µìš© í”„ë¦°í„°"
    ],

    # ê°€êµ¬ / ì§‘ê¸°
    "ì±…ìƒ": [
        "ê°•ì˜ì‹¤ í™˜ê²½ ê°œì„ ",
        "ì—°êµ¬ì‹¤ ì§‘ê¸° êµì²´",
        "ì‹ ê·œ ì—°êµ¬ì‹¤ êµ¬ì¶•"
    ],
    "ì‘ì—…ìš©ì˜ì": [
        "ì‚¬ë¬´í™˜ê²½ ê°œì„ ",
        "ë…¸í›„ ì§‘ê¸° êµì²´"
    ],
    "ì±…ê±¸ìƒ": [
        "ê°•ì˜ì‹¤ ì§‘ê¸° êµì²´",
        "ë…¸í›„ ì±…ê±¸ìƒ êµì²´"
    ],
    "ì„œëí˜•ìˆ˜ë‚©ì¥": [
        "ì—°êµ¬ì‹¤ ë¬¸ì„œ ë³´ê´€ìš©",
        "í–‰ì • ìë£Œ ìˆ˜ë‚©ìš©"
    ],

    # êµìœ¡ ê¸°ìì¬
    "ì¹ íŒë³´ì¡°ì¥": [
        "ê°•ì˜ì‹¤ ê¸°ìì¬ ë³´ê°•",
        "ë…¸í›„ ê¸°ìì¬ êµì²´"
    ],
    "ì¸í„°ë™í‹°ë¸Œí™”ì´íŠ¸ë³´ë“œ": [
        "ìŠ¤ë§ˆíŠ¸ ê°•ì˜ì‹¤ êµ¬ì¶•",
        "ë””ì§€í„¸ ê°•ì˜ í™˜ê²½ ê°œì„ "
    ],
}

# ---------------------------------------------------------
# 1. ë§ˆìŠ¤í„° ë°ì´í„° ì •ì˜ (Master Data)
# ---------------------------------------------------------
# 1-1. G2B í’ˆëª© ë§ˆìŠ¤í„° (17ê°œ í‘œì¤€ í’ˆëª©)
# êµ¬ì¡°: [ë¬¼í’ˆë¶„ë¥˜ì½”ë“œ(8), ë¬¼í’ˆì‹ë³„ì½”ë“œ(8), í’ˆëª©ëª…, ë¶„ë¥˜ëª…, ë‚´ìš©ì—°ìˆ˜, í‰ê· ë‹¨ê°€(ì›)]
# ìº í¼ìŠ¤ ì„¤ì •
CAMPUS_TYPES = ['ì„œìš¸', 'ERICA']
CAMPUS_PROBS = [0.5, 0.5] # 5:5 ë¹„ìœ¨

G2B_MASTER_DATA = [
    # =========================
    # ì „ìÂ·ì •ë³´Â·í†µì‹ Â·ì˜ìƒ (10)
    # =========================
    ("43211503", "24343967",  
     "ë…¸íŠ¸ë¶ì»´í“¨í„°", # í’ˆëª©ëª…
     "ë…¸íŠ¸ë¶ì»´í“¨í„°, Dell, (CN)Latitude 3520-5110H, Intel Core i5 1135G7(2.4GHz), ì•¡ì„¸ì„œë¦¬ë³„ë„", # ë¶„ë¥˜ëª…
     6,  # ë‚´ìš©ì—°ìˆ˜ = ë…¸íŠ¸ë¶ ê´€í–‰ ê°’
     1133000),  # í‰ê· ë‹¨ê°€ = ê³„ì•½ë‹¨ê°€ í‰ê· 

    ("43211503", "24510198", # ë…¸íŠ¸ë¶
     "ë…¸íŠ¸ë¶ì»´í“¨í„°",
     "ë…¸íŠ¸ë¶ì»´í“¨í„°, Lenovo, (CN)82JBS00300, Intel Celeron N5100(1.1GHz), ì•¡ì„¸ì„œë¦¬ë³„ë„", 
     6,  
     555000),  

    ("43211507", "24355228",  # ë°ìŠ¤í¬í†±
     "ë°ìŠ¤í¬í†±ì»´í“¨í„°",
     "ë°ìŠ¤í¬í†±ì»´í“¨í„°, Dell, (CN)OptiPlex 5090, Intel Core i5 10505(3.1GHz)",
     5,
     2627000),

    ("43211507", "24158946",  # ë°ìŠ¤í¬í†±
     "ë°ìŠ¤í¬í†±ì»´í“¨í„°",
     "ë°ìŠ¤í¬í†±ì»´í“¨í„°, ì„œë²„ì•¤ì»´í“¨í„°, DECA-N3802, Intel Core i3 10100(3.6GHz)",
     5,
     546000),

    ("43211902", "24407366",  # ëª¨ë‹ˆí„°
     "LCDíŒ¨ë„ë˜ëŠ”ëª¨ë‹ˆí„°",
     "ì•¡ì •ëª¨ë‹ˆí„°, ì—˜ì§€ì „ì, 27MP500W, 68.6cm",
     5,
     513000),

    ("43212105", "23858386",  # ë ˆì´ì €í”„ë¦°í„°
     "ë ˆì´ì €í”„ë¦°í„°",
     "ë ˆì´ì €í”„ë¦°í„°, HP, (JP)HP Color LaserJet Enterprise M856dn, A3/ì»¬ëŸ¬56/í‘ë°±56ppm",
     6,
     3465000),

    ("43211711", "24204348",  # ìŠ¤ìºë„ˆ
     "ìŠ¤ìºë„ˆ",
     "ìŠ¤ìºë„ˆ, Kodak alaris, (CN)S3100F, 600dpi",
     6,
     5500000),

    ("43222609", "23908131",  # ë¼ìš°í„°
     "ë„¤íŠ¸ì›Œí¬ë¼ìš°í„°",
     "43222609 ë„¤íŠ¸ì›Œí¬ë¼ìš°í„°",
     9,
     542000),

    ("43201803", "23809899",  # HDD
     "í•˜ë“œë””ìŠ¤í¬ë“œë¼ì´ë¸Œ",
     "í•˜ë“œë””ìŠ¤í¬ë“œë¼ì´ë¸Œ, Hitachi vantara, (US)R2H-H10RSS, 10TB",
     7,
     5340000),

    ("43223308", "22060848",  # ë„¤íŠ¸ì›Œí¬ ë™
     "ë„¤íŠ¸ì›Œí¬ì‹œìŠ¤í…œì¥ë¹„ìš©ë™",
     "ë„¤íŠ¸ì›Œí¬ì‹œìŠ¤í…œì¥ë¹„ìš©ë™, 600Ã—2000Ã—750mm",
     10,
     891700),
    # =========================
    # ì‚¬ë¬´Â·êµìœ¡Â·ê°€êµ¬ (5)
    # =========================
    ("56101703", "25114372",  # ì±…ìƒ
     "ì±…ìƒ",
     "ì±…ìƒ, ìš°ë“œë¦¼, WD-WIZDE100, 2700Ã—2150Ã—750mm, 1ì¸ìš©",
     9,
     6000000),

    ("56112102", "24128496",  # ì‘ì—…ìš©ì˜ì
     "ì‘ì—…ìš©ì˜ì",
     "ì‘ì—…ìš©ì˜ì, ì˜¤í”¼ìŠ¤ì•ˆê±´ì‚¬, AC-051, 513Ã—520Ã—783mm",
     8,
     93000),

    ("56112108", "24917370",  # ì±…ê±¸ìƒ(ì½¤ë¹„ì˜ì)
     "ì±…ìƒìš©ì½¤ë¹„ì˜ì",
     "ì±…ê±¸ìƒ, ì• ë‹ˆì²´, AMD-WT100A, 617Ã—790Ã—850mm",
     10,
     465000),

    ("56121798", "25616834",  # ì¹ íŒë³´ì¡°ì¥
     "ì¹ íŒë³´ì¡°ì¥",
     "ì¹ íŒë³´ì¡°ì¥, ìš°ë“œë¦¼, WR-BSC7040, 7000Ã—300Ã—3000mm",
     7,
     10500000),

    ("44111911", "25460962",  # ì¸í„°ë™í‹°ë¸Œí™”ì´íŠ¸ë³´ë“œ
     "ì¸í„°ë™í‹°ë¸Œí™”ì´íŠ¸ë³´ë“œë°ì•¡ì„¸ì„œë¦¬",
     "ì¸í„°ë™í‹°ë¸Œí™”ì´íŠ¸ë³´ë“œ, ë¯¸ë˜ë””ìŠ¤í”Œë ˆì´, MDI86110, 279.4cm, IRì„¼ì„œ/ì†/ë„êµ¬/LED",
     7,
     24200000),
]
# [NEW] íŠ¹ìˆ˜ ëª©ì  ë¬¼í’ˆ (ë³„ë„ ë¡œì§ ì ìš©)
# ì¼ë°˜ í™•ë¥  ë¶„í¬ë¥¼ ë”°ë¥´ì§€ ì•Šê³ , íŠ¹ì • ë¶€ì„œì—ë§Œ ê³ ì • ìˆ˜ëŸ‰ ë°°ì •
SPECIAL_ITEM_SERVER = ("43232902", "25461942", 
     "í†µì‹ ì„œë²„ì†Œí”„íŠ¸ì›¨ì–´", 
     "í†µì‹ ì†Œí”„íŠ¸ì›¨ì–´, ì„¸ì¸íŠ¸ë¡œê·¸, SMART-CM V1.5, í†µí•©ë°©ì†¡ì†”ë£¨ì…˜, 1~4Core(Server)",
     6, 60000000)
# 1-2. ë¶€ì„œ ë§ˆìŠ¤í„° (ì¡°ì§ë„)
DEPT_MASTER_DATA = [
    ("C354", "ì†Œí”„íŠ¸ì›¨ì–´ìœµí•©ëŒ€í•™RCí–‰ì •íŒ€(ERICA)"),
    ("C352", "ê³µí•™ëŒ€í•™RCí–‰ì •íŒ€(ERICA)"),
    ("C364", "ê²½ìƒëŒ€í•™RCí–‰ì •íŒ€(ERICA)"),
    ("C360", "ê¸€ë¡œë²Œë¬¸í™”í†µìƒëŒ€í•™RCí–‰ì •íŒ€(ERICA)"),
    ("A351", "ì‹œì„¤íŒ€(ERICA)"),
    ("A320", "í•™ìƒì§€ì›íŒ€(ERICA)"),
]
# ---------------------------------------------------------
# [ìˆ˜ì •] í˜„ì‹¤ ê¸°ë°˜ í™•ë¥  ë¶„í¬ ì„¤ì • (Items & Departments)
# ---------------------------------------------------------

# 1. ì „ì²´ ë¬¼í’ˆ ì¤‘ í•´ë‹¹ ë¬¼í’ˆì´ ì„ íƒë  í™•ë¥  (ì´ 15ê°œ í•­ëª©)
ITEM_WEIGHTS = [
    # =========================
    # IT / ì „ì‚° ì¥ë¹„ (72%)
    # =========================
    0.135,  # ë…¸íŠ¸ë¶ (ê³ ê¸‰í˜•) - ê¸°ì¡´ 0.160 -> 0.135
    0.105,  # ë…¸íŠ¸ë¶ (ë³´ê¸‰í˜•) - ê¸°ì¡´ 0.130 -> 0.105
    0.115,  # ë°ìŠ¤í¬í†± (ê³ ê¸‰í˜•) - ê¸°ì¡´ 0.140 -> 0.115
    0.085,  # ë°ìŠ¤í¬í†± (ë³´ê¸‰í˜•) - ê¸°ì¡´ 0.110 -> 0.085
    0.120,  # ëª¨ë‹ˆí„°
    0.055,  # ë ˆì´ì €í”„ë¦°í„°
    0.030,  # ìŠ¤ìºë„ˆ
    0.020,  # ë„¤íŠ¸ì›Œí¬ë¼ìš°í„°
    0.020,  # HDD
    0.015,  # ë„¤íŠ¸ì›Œí¬ë™

    # =========================
    # ì‚¬ë¬´Â·êµìœ¡Â·ê°€êµ¬ (28%)
    # =========================
    0.070,  # ì±…ìƒ
    0.090,  # ì‘ì—…ìš©ì˜ì
    0.055,  # ì±…ê±¸ìƒ
    0.040,  # ì¹ íŒë³´ì¡°ì¥
    0.045,  # ì¸í„°ë™í‹°ë¸Œí™”ì´íŠ¸ë³´ë“œ
]
# ITEM_WEIGHTS í•©ê³„ ê²€ì¦ ë¡œì§ ì¶”ê°€
_item_weights_sum = sum(ITEM_WEIGHTS)
if abs(_item_weights_sum - 1.0) >= 0.001:
    raise ValueError(f"ITEM_WEIGHTS sum is {_item_weights_sum}, must be 1.0")
# 2. ê° ë¬¼í’ˆë³„ ë¶€ì„œ êµ¬ë§¤ ë¹„ìœ¨ (ì¸ë±ìŠ¤: G2B_MASTER_DATAì˜ ì¸ë±ìŠ¤)
# ë¶€ì„œ ìˆœì„œ: [C354(ì†Œí”„íŠ¸), C352(ê³µí•™), C364(ê²½ìƒ), C360(ê¸€ë¡œë²Œ), A351(ì‹œì„¤), A320(í•™ìƒ)]
DEPT_WEIGHTS_BY_ITEM = {
    # === IT / ì „ì‚° ì¥ë¹„ ===
    0: [0.18, 0.20, 0.10, 0.07, 0.10, 0.35], # ë…¸íŠ¸ë¶
    1: [0.18, 0.20, 0.10, 0.07, 0.10, 0.35], # ë…¸íŠ¸ë¶
    2: [0.20, 0.22, 0.08, 0.05, 0.15, 0.30], # ë°ìŠ¤í¬í†±
    3: [0.20, 0.22, 0.08, 0.05, 0.15, 0.30], # ë°ìŠ¤í¬í†±
    4: [0.17, 0.20, 0.09, 0.07, 0.12, 0.35], # ëª¨ë‹ˆí„°
    5: [0.14, 0.12, 0.08, 0.06, 0.15, 0.45], # ë ˆì´ì €í”„ë¦°í„°
    6: [0.12, 0.10, 0.08, 0.05, 0.20, 0.45], # ìŠ¤ìºë„ˆ
    7: [0.03, 0.04, 0.01, 0.01, 0.85, 0.06], # ë¼ìš°í„°
    8: [0.02, 0.03, 0.01, 0.01, 0.88, 0.05], # HDD
    9: [0.00, 0.01, 0.00, 0.00, 0.95, 0.04], # ë™ (2000mm)

    
    # === ì‚¬ë¬´ / ê°€êµ¬ ===
    10: [0.18, 0.20, 0.15, 0.12, 0.20, 0.15], # ì±…ìƒ
    11: [0.20, 0.22, 0.15, 0.13, 0.15, 0.15], # ì‘ì—…ìš©ì˜ì
    12: [0.18, 0.30, 0.20, 0.22, 0.05, 0.05], # ì±…ê±¸ìƒ
    13: [0.20, 0.30, 0.25, 0.15, 0.08, 0.02], # ì¹ íŒë³´ì¡°ì¥
    14: [0.22, 0.32, 0.20, 0.14, 0.10, 0.02], # í™”ì´íŠ¸ë³´ë“œ
}
def _validate_dept_weights_by_item():
    """
    Validate that DEPT_WEIGHTS_BY_ITEM has the expected structure:
    - All item indices from 0 to 14 are present.
    - Each item has exactly 6 department weights.
    - Each set of weights sums to 1.0 (within a small numerical tolerance).
    """
    expected_num_items = 15
    expected_num_depts = 6
    missing_indices = [i for i in range(expected_num_items) if i not in DEPT_WEIGHTS_BY_ITEM]
    if missing_indices:
        raise ValueError(
            f"DEPT_WEIGHTS_BY_ITEM is missing definitions for item indices: {missing_indices}"
        )
    for item_idx, weights in DEPT_WEIGHTS_BY_ITEM.items():
        if len(weights) != expected_num_depts:
            raise ValueError(
                f"DEPT_WEIGHTS_BY_ITEM[{item_idx}] has {len(weights)} weights; "
                f"expected {expected_num_depts}."
            )
        total_weight = sum(weights)
        if not np.isclose(total_weight, 1.0, atol=1e-6):
            raise ValueError(
                f"DEPT_WEIGHTS_BY_ITEM[{item_idx}] weights sum to {total_weight:.10f}; "
                "expected sum of 1.0."
            )
_validate_dept_weights_by_item()
# ---------------------------------------------------------
# 2. ë°ì´í„° ìƒì„± ë¡œì§ (Phase 1)
# ---------------------------------------------------------
# ---------------------------------------------------------
# 1. ë°ì´í„° ìƒì„± í•¨ìˆ˜ ì •ì˜
# ---------------------------------------------------------
def generate_acquisition_data(count):
    print(f"ğŸš€ [Phase 1] ë¬¼í’ˆ ì·¨ë“ ë°ì´í„° {count}ê±´ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤...")
    
    acquisition_list = []
    
    # ê¸°ì¤€ì¼ì ì„¤ì •
    now = datetime.now()
    today = datetime(now.year, now.month, now.day)
    
    # ë¬¼í’ˆ ì¸ë±ìŠ¤ ë¦¬ìŠ¤íŠ¸ (0 ~ len(G2B_MASTER_DATA)-1)
    item_indices = range(len(G2B_MASTER_DATA))

    for _ in range(count):
        # -------------------------------------------------
        # 1) ê¸°ë³¸ ì •ë³´ ì„ íƒ (ê°€ì¤‘ì¹˜ ì ìš©)
        # -------------------------------------------------
        # ë¬¼í’ˆ ì„ ì •
        selected_idx = random.choices(item_indices, weights=ITEM_WEIGHTS, k=1)[0]
        g2b_item = G2B_MASTER_DATA[selected_idx]
        
        # ë¶€ì„œ ì„ ì • (ë¬¼í’ˆë³„ ê°€ì¤‘ì¹˜ ì ìš©)
        dept_weights = DEPT_WEIGHTS_BY_ITEM[selected_idx]
        dept = random.choices(DEPT_MASTER_DATA, weights=dept_weights, k=1)[0]
        
        # G2B ì •ë³´ ì–¸íŒ¨í‚¹
        class_code, id_code, item_name, class_name, life_years, base_price = g2b_item
        g2b_full_code = class_code + id_code # 16ìë¦¬ ëª©ë¡ë²ˆí˜¸
        
        # -------------------------------------------------
        # 2) ìŠ¹ì¸ ìƒíƒœ ê²°ì • (í™•ì •/ëŒ€ê¸°/ë°˜ë ¤)
        # -------------------------------------------------
        approval_status = np.random.choice(APPROVAL_STATUSES, p=APPROVAL_RATIOS)
        
        # -------------------------------------------------
        # 3) ë‚ ì§œ ìƒì„± ë¡œì§ (ë””í…Œì¼ ìœ ì§€)
        # -------------------------------------------------
        start_date_range = datetime(2015, 1, 1)
        
        # 'ëŒ€ê¸°' ìƒíƒœëŠ” ìµœê·¼(2024ë…„ 10ì›” ì´í›„)ì— ëª°ë ¤ìˆë„ë¡ ì„¤ì •
        if approval_status == 'ëŒ€ê¸°':
            wait_start = datetime(2024, 10, 1)
            # wait_startê°€ todayë³´ë‹¤ ë¯¸ë˜ì¸ ê²½ìš° ë°©ì§€
            if wait_start > today: wait_start = today
            temp_date = fake.date_between(start_date=wait_start, end_date=today)
        else:
            temp_date = fake.date_between(start_date=start_date_range, end_date=today)
        
        # datetime ê°ì²´ ë³€í™˜
        acq_date = datetime(temp_date.year, temp_date.month, temp_date.day)

        # ìº í¼ìŠ¤ ëœë¤ ë°°ì •
        campus = np.random.choice(CAMPUS_TYPES, p=CAMPUS_PROBS)
        
        # -------------------------------------------------
        # 4) ì •ë¦¬ì¼ì ìƒì„±
        # -------------------------------------------------
        clear_date = None
        if approval_status == 'í™•ì •':
            random_days = random.randint(3, 14)
            clear_date = (acq_date + timedelta(days=random_days))
            # ì •ë¦¬ì¼ìëŠ” í˜„ì¬ ë‚ ì§œë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì œí•œ
            if clear_date > today:
                clear_date = today
                
        # -------------------------------------------------
        # 5) ìˆ˜ëŸ‰ ë° ê¸ˆì•¡ ìƒì„± (í’ˆëª©ë³„ ì°¨ì´ ë°˜ì˜)
        # -------------------------------------------------
        # ì±…ìƒ/ì˜ìë¥˜ëŠ” ëŒ€ëŸ‰ êµ¬ë§¤ ê°€ëŠ¥ì„± ë†’ìŒ
        if "ì±…ìƒ" in item_name or "ì˜ì" in item_name:
            # ì˜ì/ì±…ìƒ: 1~5ê°œ(ì†Œê·œëª¨) vs 10~50ê°œ(ê°•ì˜ì‹¤) í˜¼í•© ë¶„í¬
            quantity = random.choices([random.randint(1, 5), random.randint(10, 50)], weights=[0.7, 0.3])[0]
        elif "PC" in item_name or "ë…¸íŠ¸ë¶" in item_name:
             # PCë¥˜: 1~5ëŒ€(ê°œì¸/ì—°êµ¬ì‹¤) vs 20~40ëŒ€(ì‹¤ìŠµì‹¤)
            quantity = random.choices([random.randint(1, 5), random.randint(20, 40)], weights=[0.85, 0.15])[0]
        else:
            # ê¸°íƒ€ ì¥ë¹„: ì†ŒëŸ‰
            quantity = random.randint(1, 5)
            
        # ì·¨ë“ê¸ˆì•¡ = (ë‹¨ê°€ * ìˆ˜ëŸ‰) + ëœë¤ ë…¸ì´ì¦ˆ(ì˜µì…˜ê°€ ë“± Â±10%)
        unit_price = int(base_price * random.uniform(0.9, 1.1)) 
        total_amount = unit_price * quantity
        total_amount = (total_amount // 1000) * 1000 # 1000ì› ë‹¨ìœ„ ì ˆì‚­
        
        # -------------------------------------------------
        # 6) ê¸°íƒ€ ì†ì„± (ì·¨ë“ì •ë¦¬êµ¬ë¶„, ë¹„ê³ )
        # -------------------------------------------------
        acq_method = np.random.choice(['ìì²´êµ¬ì…', 'ìì²´ì œì‘', 'ê¸°ì¦'], p=[0.95, 0.02, 0.03])
        
        remark = ""
        if approval_status == 'ë°˜ë ¤':
            remark = "ì˜ˆì‚° ì´ˆê³¼ë¡œ ì¸í•œ ë°˜ë ¤"
        elif random.random() < 0.1: # 10% í™•ë¥ ë¡œ ë¹„ê³  ìƒì„±
            # ê¸°ì¡´ split(' ')[1] ë°©ì‹ ì œê±°í•˜ê³  ì•ˆì „í•œ ë§¤í•‘ ë¡œì§ ì ìš©
            try:
                # ìš°ì„ ìˆœìœ„ 1: item_name ê·¸ëŒ€ë¡œ ì‚¬ìš© ("ë…¸íŠ¸ë¶ì»´í“¨í„°")
                key_candidate = item_name
                
                # ë§¤í•‘ë˜ì§€ ì•Šìœ¼ë©´ ì½¤ë§ˆë¡œ ë¶„ë¦¬ ì‹œë„ (í˜¹ì‹œ class_nameì— ë¸Œëœë“œ ë“±ì´ ì„ì¸ ê²½ìš°)
                if key_candidate not in REMARK_TEMPLATES_BY_CLASS:
                    # ì˜ˆ: "ë…¸íŠ¸ë¶ì»´í“¨í„°, LGì „ì" -> "ë…¸íŠ¸ë¶ì»´í“¨í„°"
                    key_candidate = str(item_name).split(',')[0].strip()

            except (IndexError, AttributeError):
                key_candidate = item_name

            candidates = REMARK_TEMPLATES_BY_CLASS.get(key_candidate, [])
            # ë§¤í•‘ ì‹¤íŒ¨ ì‹œ í¬ê´„ì ì¸ í‚¤ì›Œë“œë¡œ ì¬ì‹œë„ (ì˜ˆ: ì»´í“¨í„° -> ë°ìŠ¤í¬í†±)
            if not candidates:
                if "ì»´í“¨í„°" in item_name: candidates = REMARK_TEMPLATES_BY_CLASS.get("ë°ìŠ¤í¬í†±ì»´í“¨í„°", [])
                elif "ì˜ì" in item_name: candidates = REMARK_TEMPLATES_BY_CLASS.get("ì‘ì—…ìš©ì˜ì", [])
            
            if candidates:
                remark = random.choice(candidates)

        # ë¬¸ìì—´ ë³€í™˜
        acq_date_str = acq_date.strftime('%Y-%m-%d')
        clear_date_str = clear_date.strftime('%Y-%m-%d') if clear_date else ""

        # -------------------------------------------------
        # 7) ë°ì´í„° ì ì¬
        # -------------------------------------------------
        row = {
            # ì‹ë³„ ì •ë³´
            'G2B_ëª©ë¡ë²ˆí˜¸': g2b_full_code,
            'G2B_ëª©ë¡ëª…': item_name,
            # G2B ìƒì„¸ (ì¡°íšŒìš©)
            'ë¬¼í’ˆë¶„ë¥˜ì½”ë“œ': class_code,
            'ë¬¼í’ˆë¶„ë¥˜ëª…': class_name,
            'ë¬¼í’ˆì‹ë³„ì½”ë“œ': id_code,
            'ë¬¼í’ˆí’ˆëª©ëª…': item_name, 
            'ìº í¼ìŠ¤': campus,  
            
            # ì·¨ë“ ì •ë³´
            'ì·¨ë“ì¼ì': acq_date_str,
            'ì·¨ë“ê¸ˆì•¡': total_amount,
            'ì •ë¦¬ì¼ì': clear_date_str,
            'ì·¨ë“ì •ë¦¬êµ¬ë¶„': acq_method,
            
            # ê´€ë¦¬ ì •ë³´
            'ìš´ìš©ë¶€ì„œ': dept[1],
            'ìš´ìš©ë¶€ì„œì½”ë“œ': dept[0],
            'ìš´ìš©ìƒíƒœ': 'ì·¨ë“',
            'ë‚´ìš©ì—°ìˆ˜': life_years,
            'ìˆ˜ëŸ‰': quantity,
            'ìŠ¹ì¸ìƒíƒœ': approval_status,
            'ë¹„ê³ ': remark
        }
        acquisition_list.append(row)
        # ---------------------------------------------------------
    # [NEW] íŠ¹ìˆ˜ ë¬¼í’ˆ(ì„œë²„) ì¶”ê°€ ë¡œì§ (Probability Injection)
    # ---------------------------------------------------------
    print("âš¡ [Phase 1] íŠ¹ìˆ˜ ë¬¼í’ˆ(í†µì‹ ì„œë²„ì†Œí”„íŠ¸ì›¨ì–´) ë°ì´í„°ë¥¼ ì£¼ì…í•©ë‹ˆë‹¤...")
    
    # 1) ì„œë²„ ë°ì´í„° ì–¸íŒ¨í‚¹
    sv_class_code, sv_id_code, sv_item_name, sv_class_name, sv_life, sv_price = SPECIAL_ITEM_SERVER
    sv_full_code = sv_class_code + sv_id_code

    # 2) ë¶€ì„œë³„ í• ë‹¹ ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜
    # (ë¶€ì„œì½”ë“œ, ë¶€ì„œëª…, ìµœì†Œìˆ˜ëŸ‰, ìµœëŒ€ìˆ˜ëŸ‰)
    server_allocations = [
        ("A351", "ì‹œì„¤íŒ€(ERICA)", 2, 3),      # ì‹œì„¤íŒ€: 2~3ëŒ€ (êµ¬ì¶•+êµì²´)
        ("A320", "í•™ìƒì§€ì›íŒ€(ERICA)", 1, 2),  # í•™ìƒíŒ€: 1~2ëŒ€
        # RC í–‰ì •íŒ€ì€ ë¦¬ìŠ¤íŠ¸ì— ì—†ìœ¼ë¯€ë¡œ ìë™ 0ê±´ ì²˜ë¦¬ë¨
    ]

    for dept_code, dept_name, min_cnt, max_cnt in server_allocations:
        # í• ë‹¹ ìˆ˜ëŸ‰ ê²°ì •
        target_qty = random.randint(min_cnt, max_cnt)
        
        for i in range(target_qty):
            # ë‚ ì§œ ìƒì„± ë¡œì§ (2015ë…„ ~ í˜„ì¬ ì‚¬ì´)
            # ìˆ˜ëŸ‰ì´ ì—¬ëŸ¬ ê°œì¼ ê²½ìš°, ì´ˆê¸° êµ¬ì¶•(ê³¼ê±°)ê³¼ êµì²´(ìµœê·¼) ëŠë‚Œì„ ì£¼ê¸° ìœ„í•´ ë‚ ì§œ ë¶„ì‚°
            if i == 0: 
                # ì²« ë²ˆì§¸ëŠ” ì¢€ ë” ê³¼ê±° (2015 ~ 2019)
                start_d = datetime(2015, 1, 1)
                end_d = datetime(2019, 12, 31)
            else:
                # ë‘ ë²ˆì§¸ ì´í›„ëŠ” ì¢€ ë” ìµœê·¼ (2020 ~ í˜„ì¬)
                start_d = datetime(2020, 1, 1)
                end_d = today
            
            # ë²”ìœ„ ë‚´ ëœë¤ ë‚ ì§œ
            temp_date = fake.date_between(start_date=start_d, end_date=end_d)
            if temp_date > today.date(): temp_date = today.date() # ë¯¸ë˜ ë°©ì§€
            acq_date = datetime(temp_date.year, temp_date.month, temp_date.day)

            # ì •ë¦¬ì¼ì (í™•ì • ì „ì œ)
            clear_date = acq_date + timedelta(days=random.randint(7, 30)) # ì„œë²„ëŠ” ë„ì… ê¸°ê°„ì´ ì¢€ ë” ê¹€
            if clear_date > today: clear_date = today

            # ë°ì´í„° ìƒì„±
            row = {
                'G2B_ëª©ë¡ë²ˆí˜¸': sv_full_code,
                'G2B_ëª©ë¡ëª…': sv_item_name,
                'ë¬¼í’ˆë¶„ë¥˜ì½”ë“œ': sv_class_code,
                'ë¬¼í’ˆë¶„ë¥˜ëª…': sv_class_name,
                'ë¬¼í’ˆì‹ë³„ì½”ë“œ': sv_id_code,
                'ë¬¼í’ˆí’ˆëª©ëª…': sv_item_name,
                'ìº í¼ìŠ¤': 'ERICA', # ì„œë²„ëŠ” ì£¼ë¡œ ìº í¼ìŠ¤ ë‹¨ìœ„ ê´€ë¦¬ì´ë¯€ë¡œ ERICA ê³ ì • (í˜¹ì€ ëœë¤)
                
                'ì·¨ë“ì¼ì': acq_date.strftime('%Y-%m-%d'),
                'ì·¨ë“ê¸ˆì•¡': sv_price, # 6ì²œë§Œì› ê³ ì •
                'ì •ë¦¬ì¼ì': clear_date.strftime('%Y-%m-%d'),
                'ì·¨ë“ì •ë¦¬êµ¬ë¶„': 'ìì²´êµ¬ì…', # ì„œë²„ëŠ” ì£¼ë¡œ êµ¬ì…
                
                'ìš´ìš©ë¶€ì„œ': dept_name,
                'ìš´ìš©ë¶€ì„œì½”ë“œ': dept_code,
                'ìš´ìš©ìƒíƒœ': 'ì·¨ë“',
                'ë‚´ìš©ì—°ìˆ˜': sv_life,
                'ìˆ˜ëŸ‰': 1, # ì„œë²„ëŠ” ëŒ€ë‹¹ ê°€ê²©ì´ ë†’ìœ¼ë¯€ë¡œ 1ëŒ€ì”© ë“±ë¡
                'ìŠ¹ì¸ìƒíƒœ': 'í™•ì •', # ê³ ê°€ ì¥ë¹„ëŠ” ì´ë¯¸ í™•ì •ëœ ê±´ë§Œ ë„˜ì–´ì˜¤ëŠ” ê²½ìš°ê°€ ë§ìŒ
                'ë¹„ê³ ': f"{dept_name} ì„œë²„ì‹¤ ìš´ìš©"
            }
            acquisition_list.append(row)

    # ---------------------------------------------------------
    # [NEW] ë¡œì§ ë
    # ---------------------------------------------------------
        
    # DataFrame ë³€í™˜
    df_acquisition = pd.DataFrame(acquisition_list)
    return df_acquisition
# ---------------------------------------------------------
# 3. ê²°ê³¼ ì €ì¥ (CSV Export)
# ---------------------------------------------------------

# í•¨ìˆ˜ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°í”„ë ˆì„ ìƒì„±
df_acquisition = generate_acquisition_data(TOTAL_COUNT)

# [03-01] ë¬¼í’ˆ ì·¨ë“ ëŒ€ì¥ ëª©ë¡ (Main Output)
# í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¶”ì¶œí•˜ì—¬ ì €ì¥
cols_acquisition = [
    'G2B_ëª©ë¡ë²ˆí˜¸', 'G2B_ëª©ë¡ëª…', 'ìº í¼ìŠ¤', 'ì·¨ë“ì¼ì', 'ì·¨ë“ê¸ˆì•¡', 'ì •ë¦¬ì¼ì', 
    'ìš´ìš©ë¶€ì„œ', 'ìš´ìš©ìƒíƒœ', 'ë‚´ìš©ì—°ìˆ˜', 'ìˆ˜ëŸ‰', 'ìŠ¹ì¸ìƒíƒœ', 
    'ì·¨ë“ì •ë¦¬êµ¬ë¶„', 'ìš´ìš©ë¶€ì„œì½”ë“œ', 'ë¹„ê³ '
]
df_acquisition[cols_acquisition].to_csv(os.path.join(SAVE_DIR, '03_01_acquisition_master.csv'), index=False, encoding='utf-8-sig')

# [03-02] G2B ëª©ë¡ ì¡°íšŒìš© (Popup Output)
# ë¶„ë¥˜ ëª©ë¡ (ì¤‘ë³µ ì œê±°)
df_class = df_acquisition[['ë¬¼í’ˆë¶„ë¥˜ì½”ë“œ', 'ë¬¼í’ˆë¶„ë¥˜ëª…']].drop_duplicates()
df_class.to_csv(os.path.join(SAVE_DIR, '03_02_g2b_class_list.csv'), index=False, encoding='utf-8-sig')

# í’ˆëª© ëª©ë¡ (ì¤‘ë³µ ì œê±°)
df_item = df_acquisition[['ë¬¼í’ˆì‹ë³„ì½”ë“œ', 'ë¬¼í’ˆí’ˆëª©ëª…', 'ë¬¼í’ˆë¶„ë¥˜ì½”ë“œ']].drop_duplicates()
df_item.to_csv(os.path.join(SAVE_DIR, '03_02_g2b_item_list.csv'), index=False, encoding='utf-8-sig')

print("âœ… [Phase 1] ë°ì´í„° ìƒì„± ì™„ë£Œ!")
print(f"   - ì´ {len(df_acquisition)}ê±´ì˜ ì·¨ë“ ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.")
print("   - ì €ì¥ íŒŒì¼: 03_01_acquisition_master.csv, 03_02_g2b_class_list.csv, 03_02_g2b_item_list.csv")
print("   - ìŠ¹ì¸ ìƒíƒœ ë¶„í¬:")
print(df_acquisition['ìŠ¹ì¸ìƒíƒœ'].value_counts())